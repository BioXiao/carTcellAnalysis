# Load packages -----------------------------------------------------------
library(ggplot2)
library(readr)
library(dplyr)
# Load data ---------------------------------------------------------------
file_path <- "data/results/P89-5_150916.csv"
gene_hits_dat <- read_csv(file_path)
View(gene_hits_dat)
View(gene_hits_dat)
names(gene_hits_dat)
# Load data ---------------------------------------------------------------
file_path <- "data/results/P89-5_150916.csv"
gene_hits_dat <- read_csv(file_path)
names(gene_hits_dat)[1] <- "lib_id"
# Plot gene counts --------------------------------------------------------
gene_hits_dat %>%
ggplot(aes(x = lib_id, y = num_reads)) %>%
geom_bar()
# Plot gene counts --------------------------------------------------------
gene_hits_dat %>%
ggplot(aes(x = lib_id, y = num_reads)) +
geom_bar()
# Plot gene counts --------------------------------------------------------
gene_hits_dat %>%
ggplot(aes(x = lib_id, y = num_reads)) +
geom_bar(stat = "identity")
# Plot gene counts --------------------------------------------------------
gene_hits_dat %>%
ggplot(aes(x = lib_id, y = num_reads)) +
geom_bar(stat = "identity") +
theme(axis.x.text = element_text(angle = 90))
# Plot gene counts --------------------------------------------------------
gene_hits_dat %>%
ggplot(aes(x = lib_id, y = num_reads)) +
geom_bar(stat = "identity") +
theme(x.axis.text = element_text(angle = 90))
# Plot gene counts --------------------------------------------------------
gene_hits_dat %>%
ggplot(aes(x = lib_id, y = num_reads)) +
geom_bar(stat = "identity") +
theme(axis.text.x = element_text(angle = 90))
# Plot gene counts --------------------------------------------------------
gene_hits_dat %>%
filter(num_reads > 0) %>%
ggplot(aes(x = lib_id, y = num_reads)) +
geom_bar(stat = "identity") +
theme(axis.text.x = element_text(angle = 90))
# Plot gene counts --------------------------------------------------------
gene_hits_dat %>%
filter(num_reads > 0) %>%
ggplot(aes(x = lib_id, y = log2(num_reads))) +
geom_bar(stat = "identity") +
theme(axis.text.x = element_text(angle = 90))
summary(gene_hits_dat)
gene_hits_dat %>% filter(num_reads > 0) %>% summary()
# Plot gene counts --------------------------------------------------------
gene_hits_dat %>%
filter(num_reads > 8) %>%
ggplot(aes(x = lib_id, y = log2(num_reads))) +
geom_bar(stat = "identity") +
theme(axis.text.x = element_text(angle = 90))
# Plot gene counts --------------------------------------------------------
gene_hits_dat %>%
filter(num_reads > 34) %>%
ggplot(aes(x = lib_id, y = log2(num_reads))) +
geom_bar(stat = "identity") +
theme(axis.text.x = element_text(angle = 90))
# Load data ---------------------------------------------------------------
file_path <- "data/results/P89-5_150916.csv"
gene_hits_dat <- read_csv(file_path)
names(gene_hits_dat)[1] <- "lib_id"
file_path_hc <- "data/results/P89-5_150916_high_conf.csv"
gene_hits_hc_dat <- read_csv(file_path)
names(gene_hits_hc_dat)[1] <- "lib_id"
# Plot high confidence gene counts ----------------------------------------
gene_hits_hc_dat %>%
filter(num_reads > 0) %>%
ggplot(aes(x = lib_id, y = log2(num_reads))) +
geom_bar(stat = "identity") +
theme(axis.text.x = element_text(angle = 90))
# Plot high confidence gene counts ----------------------------------------
gene_hits_hc_dat %>%
filter(num_reads > 0) %>%
tally()
# Plot gene counts --------------------------------------------------------
car_libs <- gene_hits_dat %>%
filter(num_reads > 34) %>%
select(lib_id)
# Plot high confidence gene counts ----------------------------------------
car_libs_hc <- gene_hits_hc_dat %>%
filter(num_reads > 0) %>%
select(lib_id)
setdiff(car_libs_hc, car_libs)
setdiff(car_libs, car_libs_hc)
# Plot gene counts --------------------------------------------------------
car_libs <- gene_hits_dat %>%
filter(num_reads > 8) %>%
select(lib_id)
# Plot gene counts --------------------------------------------------------
car_libs <- gene_hits_dat %>%
filter(num_reads > 0) %>%
select(lib_id)
View(gene_hits_dat)
View(gene_hits_hc_dat)
# Load data ---------------------------------------------------------------
file_path <- "data/results/P89-5_150916.csv"
gene_hits_dat <- read_csv(file_path)
names(gene_hits_dat)[1] <- "lib_id"
file_path_hc <- "data/results/P89-5_150916_high_conf.csv"
gene_hits_hc_dat <- read_csv(file_path)
names(gene_hits_hc_dat)[1] <- "lib_id"
# Load data ---------------------------------------------------------------
file_path <- "data/results/P89-5_150916.csv"
gene_hits_dat <- read_csv(file_path)
names(gene_hits_dat)[1] <- "lib_id"
file_path_hc <- "data/results/P89-5_150916_high_conf.csv"
gene_hits_hc_dat <- read_csv(file_path_hc)
names(gene_hits_hc_dat)[1] <- "lib_id"
# Plot high confidence gene counts ----------------------------------------
car_libs_hc <- gene_hits_hc_dat %>%
filter(num_reads > 0) %>%
select(lib_id)
?left_join
# Join data ---------------------------------------------------------------
gene_hits_all <- gene_hits_dat %>%
left_join(gene_hits_hc_dat)
# Join data ---------------------------------------------------------------
gene_hits_all <- gene_hits_dat %>%
select(-tpm) %>%
left_join(gene_hits_hc_dat %>%
select(-tpm))
View(gene_hits_all)
# Join data ---------------------------------------------------------------
gene_hits_all <- gene_hits_dat %>%
select(-tpm) %>%
left_join(gene_hits_hc_dat %>%
select(-tpm) %>%
rename(num_reads_hc = num_reads))
View(gene_hits_all)
# Join data ---------------------------------------------------------------
gene_hits_all <- gene_hits_dat %>%
select(-tpm) %>%
left_join(gene_hits_hc_dat %>%
select(-tpm) %>%
rename(num_reads_hc = num_reads)) %>%
mutate(weak = ifelse(num_reads > 0, TRUE, FALSE),
medium = ifelse(num_reads > median(num_reads), TRUE, FALSE),
strong = ifelse(num_reads_hc > 0, TRUE, FALSE))
View(gene_hits_all)
# Plot gene counts --------------------------------------------------------
car_libs <- gene_hits_dat %>%
melt(measure.vars = c("num_reads", "num_reads_hc")) %>%
head()
#     filter(medium) %>%
#     ggplot(aes(x = lib_id, y = num_reads))
# Load packages -----------------------------------------------------------
library(ggplot2)
library(readr)
library(reshape2)
library(dplyr)
# Plot gene counts --------------------------------------------------------
car_libs <- gene_hits_dat %>%
melt(measure.vars = c("num_reads", "num_reads_hc")) %>%
head()
#     filter(medium) %>%
#     ggplot(aes(x = lib_id, y = num_reads))
# Plot gene counts --------------------------------------------------------
car_libs <- gene_hits_all %>%
melt(measure.vars = c("num_reads", "num_reads_hc")) %>%
head()
#     filter(medium) %>%
#     ggplot(aes(x = lib_id, y = num_reads))
View(car_libs)
gene_hits_all %>%
melt(measure.vars = c("num_reads", "num_reads_hc")) %>%
head()
?melt
# Plot gene counts --------------------------------------------------------
gene_hits_all %>%
melt(measure.vars = c("num_reads", "num_reads_hc"),
variable.name = "confidence", value.name = "num_reads") %>%
head()
#     filter(medium) %>%
#     ggplot(aes(x = lib_id, y = num_reads))
# Load packages -----------------------------------------------------------
library(ggplot2)
library(readr)
library(stringr)
library(reshape2)
library(dplyr)
# Plot gene counts --------------------------------------------------------
gene_hits_all %>%
melt(measure.vars = c("num_reads", "num_reads_hc"),
variable.name = "confidence", value.name = "num_reads") %>%
mutate(confidence = ifelse(str_detect(confidence, "hc"), "high", "low"))
head()
#     filter(medium) %>%
#     ggplot(aes(x = lib_id, y = num_reads))
# Plot gene counts --------------------------------------------------------
gene_hits_all %>%
melt(measure.vars = c("num_reads", "num_reads_hc"),
variable.name = "confidence", value.name = "num_reads") %>%
mutate(confidence = ifelse(str_detect(confidence, "hc"), "high", "low")) %>%
head()
#     filter(medium) %>%
#     ggplot(aes(x = lib_id, y = num_reads))
# Plot gene counts --------------------------------------------------------
gene_hits_all %>%
filter(medium) %>%
melt(measure.vars = c("num_reads", "num_reads_hc"),
variable.name = "confidence", value.name = "num_reads") %>%
mutate(confidence = ifelse(str_detect(confidence, "hc"),
"high", "low")) %>%
head()
#     filter(medium) %>%
#     ggplot(aes(x = lib_id, y = num_reads))
# Plot gene counts --------------------------------------------------------
gene_hits_all %>%
filter(medium) %>%
melt(measure.vars = c("num_reads", "num_reads_hc"),
variable.name = "confidence", value.name = "num_reads") %>%
mutate(confidence = ifelse(str_detect(confidence, "hc"),
"high", "low")) %>%
ggplot(aes(x = lib_id, y = num_reads)) +
geom_bar(aes(fill = confidence), stat = "identity")
# Plot gene counts --------------------------------------------------------
gene_hits_all %>%
filter(medium) %>%
melt(measure.vars = c("num_reads", "num_reads_hc"),
variable.name = "confidence", value.name = "num_reads") %>%
mutate(confidence = ifelse(str_detect(confidence, "hc"),
"high", "low")) %>%
ggplot(aes(x = lib_id, y = num_reads)) +
geom_bar(aes(fill = confidence), stat = "identity", position = "dodge")
# Plot gene counts --------------------------------------------------------
gene_hits_all %>%
filter(medium) %>%
melt(measure.vars = c("num_reads", "num_reads_hc"),
variable.name = "confidence", value.name = "num_reads") %>%
mutate(confidence = ifelse(str_detect(confidence, "hc"),
"high", "low")) %>%
ggplot(aes(x = lib_id, y = log2(num_reads))) +
geom_bar(aes(fill = confidence), stat = "identity", position = "dodge")
# Plot gene counts --------------------------------------------------------
gene_hits_all %>%
filter(medium) %>%
melt(measure.vars = c("num_reads", "num_reads_hc"),
variable.name = "confidence", value.name = "num_reads") %>%
mutate(confidence = ifelse(str_detect(confidence, "hc"),
"high", "low")) %>%
filter(num_reads > 0) %>%
ggplot(aes(x = lib_id, y = log2(num_reads))) +
geom_bar(aes(fill = confidence), stat = "identity", position = "dodge")
# Plot gene counts --------------------------------------------------------
gene_hits_all %>%
filter(medium) %>%
melt(measure.vars = c("num_reads", "num_reads_hc"),
variable.name = "confidence", value.name = "num_reads") %>%
mutate(confidence = ifelse(str_detect(confidence, "hc"),
"high", "low")) %>%
ggplot(aes(x = lib_id, y = num_hits)) +
geom_bar(aes(fill = confidence), stat = "identity", position = "dodge")
# Plot gene counts --------------------------------------------------------
gene_hits_all %>%
filter(medium) %>%
melt(measure.vars = c("num_reads", "num_reads_hc"),
variable.name = "confidence", value.name = "num_reads") %>%
mutate(confidence = ifelse(str_detect(confidence, "hc"),
"high", "low")) %>%
ggplot(aes(x = lib_id, y = num_reads)) +
geom_bar(aes(fill = confidence), stat = "identity", position = "dodge")
# Plot gene counts --------------------------------------------------------
gene_hits_all %>%
filter(medium) %>%
melt(measure.vars = c("num_reads", "num_reads_hc"),
variable.name = "confidence", value.name = "num_reads") %>%
mutate(confidence = ifelse(str_detect(confidence, "hc"),
"high", "low")) %>%
ggplot(aes(x = lib_id, y = num_reads)) +
geom_bar(aes(fill = confidence),
stat = "identity", position = "dodge") +
coord_flip()
sum(gene_hits_all$medium)
x1 <- data_frame(gene_id = c('a','b','c'), lib1 = c(1, 2, 3))
x1
word <- 'sample4_namesorted'
gsub('(.+?)_namesorted', '\\1', word)
gsub('(.+?)_namesorted', '1', word)
gsub('(.+?)_namesorted', '\\1', word)
x2 <- data_frame(gene_id = c('A','B','C'), lib2 = c(1, 2, 3))
merge(x1, x2, by=0, all=TRUE)
# Locate files ------------------------------------------------------------
result_folder <- "data/results"
list.files(result_folder)
# Locate files ------------------------------------------------------------
result_folder <- "data/results"
list.files(result_folder) %>%
.[str_detect(., "150(729|916)")]
# Locate files ------------------------------------------------------------
result_folder <- "data/results"
list.files(result_folder) %>%
.[str_detect(., "150(729|910)")]
# Locate files ------------------------------------------------------------
result_folder <- "data/results"
gene_hits_files <- list.files(result_folder) %>%
.[str_detect(., "150(729|910).csv")]
gene_hits_files
# Locate files ------------------------------------------------------------
result_folder <- "data/results"
gene_hits_files <- list.files(result_folder) %>%
.[str_detect(., "150(729|910).csv")]
gene_hits_hc_files <- list.files(result_folder) %>%
.[str_detect(., "150(729|910)_high_conf.csv")]
# Locate files ------------------------------------------------------------
result_folder <- "data/results"
gene_hits_files <- list.files(result_folder, full.names = TRUE) %>%
.[str_detect(., "150(729|910).csv")]
gene_hits_hc_files <- list.files(result_folder, full.names = TRUE) %>%
.[str_detect(., "150(729|910)_high_conf.csv")]
test_list <- lapply(as.list(gene_hits_files), read_csv)
test_list
test_list <- lapply(as.list(gene_hits_files), read_csv) %>%
bind_rows()
# Load data ---------------------------------------------------------------
test_list <- lapply(as.list(gene_hits_files), function(x) {
df <- read_csv(x)
names(df)[1] <- "lib_id"
return(df)
}) %>%
bind_rows()
View(gene_hits_hc_dat)
View(test_list)
# Load data ---------------------------------------------------------------
gene_hits_dat <- lapply(as.list(gene_hits_files), function(x) {
df <- read_csv(x)
names(df)[1] <- "lib_id"
return(df)
}) %>%
bind_rows()
gene_hits_hc_dat <- lapply(as.list(gene_hits_hc_files), function(x) {
df <- read_csv(x)
names(df)[1] <- "lib_id"
return(df)
}) %>%
bind_rows()
# Join, summarize data ----------------------------------------------------
gene_hits_all <- gene_hits_dat %>%
select(-tpm) %>%
left_join(gene_hits_hc_dat %>%
select(-tpm) %>%
rename(num_reads_hc = num_reads)) %>%
mutate(weak = ifelse(num_reads > 0, TRUE, FALSE),
medium = ifelse(num_reads > median(num_reads), TRUE, FALSE),
strong = ifelse(num_reads_hc > 0, TRUE, FALSE))
View(gene_hits_all)
mean(gene_hits_all$medium)
mean(gene_hits_all$weak)
mean(gene_hits_all$strong)
# Summarize data ----------------------------------------------------------
gene_hits_all %>%
summarise_each_(funs = mean, vars = c("weak", "medium", "strong"))
?summarise_each_
# Summarize data ----------------------------------------------------------
gene_hits_all %>%
summarise_each_(funs(mean), vars = c("weak", "medium", "strong"))
# Summarize data ----------------------------------------------------------
# overall rates of CAR gene detection with weak, medium, or strong evidence
gene_hits_all %>%
summarise_each_(funs(mean), vars = c("weak", "medium", "strong"))
# rates by project
gene_hits_all %>%
group_by(flowcell, project) %>%
summarise_each_(funs(mean), vars = c("weak", "medium", "strong"))
# Summarize data ----------------------------------------------------------
# overall rates of CAR gene detection with weak, medium, or strong evidence
gene_hits_all %>%
summarise_each_(funs(mean), vars = c("weak", "medium", "strong"))
# rates by project
gene_hits_all %>%
group_by(project) %>%
summarise_each_(funs(mean), vars = c("weak", "medium", "strong"))
# Summarize data ----------------------------------------------------------
# overall rates of CAR gene detection with weak, medium, or strong evidence
gene_hits_all %>%
summarise_each_(funs(mean), vars = c("weak", "medium", "strong"))
# rates by project
gene_hits_all %>%
group_by(project) %>%
summarise_each_(funs(mean), vars = c("weak", "medium", "strong"))
# rates by project and flowcell
gene_hits_all %>%
group_by(flowcell, project) %>%
summarise_each_(funs(mean), vars = c("weak", "medium", "strong"))
# Plot gene counts --------------------------------------------------------
gene_hits_all %>%
filter(medium) %>%
melt(measure.vars = c("num_reads", "num_reads_hc"),
variable.name = "confidence", value.name = "num_reads") %>%
mutate(confidence = ifelse(str_detect(confidence, "hc"),
"high", "low")) %>%
ggplot(aes(x = lib_id, y = num_reads)) +
geom_bar(aes(fill = confidence),
stat = "identity", position = "dodge") +
coord_flip()
# Locate files ------------------------------------------------------------
# assumes result files located in the following subfolder
result_folder <- "data/results"
# get list of all low confidence read count files for relevant flowcells
gene_hits_files <- list.files(result_folder, full.names = TRUE) %>%
.[str_detect(., "150(729|910).csv")]
# get list of all high confidence read count files for relevant flowcells
gene_hits_hc_files <- list.files(result_folder, full.names = TRUE) %>%
.[str_detect(., "150(729|910)_high_conf.csv")]
# Load data ---------------------------------------------------------------
# read and merge all low confidence read count files
gene_hits_dat <- lapply(as.list(gene_hits_files), function(x) {
df <- read_csv(x)
names(df)[1] <- "lib_id"
return(df)
}) %>%
bind_rows()
# read and merge all high confidence read count files
gene_hits_hc_dat <- lapply(as.list(gene_hits_hc_files), function(x) {
df <- read_csv(x)
names(df)[1] <- "lib_id"
return(df)
}) %>%
bind_rows()
# Join, score data --------------------------------------------------------
# combine low and high confidence read counts, score libs as weak, medium, or
# strong supporting evidence (thresholds are somewhat arbitrary):
#   ~ weak - count > 0 in low confidence data
#   ~ medium - count > median count in low confidence data
#   ~ strong - count > 0 in high confidence data
gene_hits_all <- gene_hits_dat %>%
select(-tpm) %>%
left_join(gene_hits_hc_dat %>%
select(-tpm) %>%
rename(num_reads_hc = num_reads)) %>%
mutate(weak = ifelse(num_reads > 0, TRUE, FALSE),
medium = ifelse(num_reads > median(num_reads), TRUE, FALSE),
strong = ifelse(num_reads_hc > 0, TRUE, FALSE))
# Summarize data ----------------------------------------------------------
# overall rates of CAR gene detection with weak, medium, or strong evidence
gene_hits_all %>%
summarise_each_(funs(mean), vars = c("weak", "medium", "strong"))
# rates by project
gene_hits_all %>%
group_by(project) %>%
summarise_each_(funs(mean), vars = c("weak", "medium", "strong"))
# rates by project and flowcell
gene_hits_all %>%
group_by(flowcell, project) %>%
summarise_each_(funs(mean), vars = c("weak", "medium", "strong"))
